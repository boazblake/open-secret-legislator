{"version":3,"sources":["app/app.js","app/index.js","app/initialize.js","app/is-loading.js","app/model.js"],"names":["log","m","v","console","getLegislators","mdl","state","HTTP","getMembers","cid","data","year","saveLegislators","legislators","loadLegislatorsData","Task","of","states","map","flatten","loadMemberProfile","loadData","status","onSuccess","members","leg","filter","onError","err","error","chain","fork","PlotFinances","oncreate","dom","attrs","type","x","l","firstlast","y","net_high","Plotly","newPlot","view","id","style","width","height","Legislators","oninit","IsLoading","min","max","step","value","onchange","e","target","root","document","body","winW","window","innerWidth","module","hot","accept","process","env","NODE_ENV","navigator","addEventListener","serviceWorker","register","then","registration","registrationError","getProfile","w","checkWidth","lastProfile","model","settings","profile","redraw","requestAnimationFrame","mount","require","margin","background","display","api","baseUrl","apiKey","legislatorUrl","memberUrl","url","rej","res","request","legislatorsUrl","membersUrl","details","Stream"],"mappings":"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","file":"docs/app.js","sourcesContent":["import m from 'mithril'\nimport { legislatorsUrl, membersUrl } from './model.js'\nimport IsLoading from './is-loading'\nimport {flatten,head,map,path, pluck,propEq,traverse} from 'ramda'\nimport Task from 'data.task'\n\nconst log = m => v => {console.log(m,v); return v}\n\nconst getLegislators = (mdl) => state => mdl.HTTP(legislatorsUrl(state))\n\nconst getMembers = mdl => cid => mdl.HTTP(membersUrl(cid)(mdl.data.year()))\n\nconst saveLegislators = mdl => legislators => {\n  mdl.data.legislators = legislators;\n  return legislators\n}\n\nconst loadLegislatorsData = mdl =>\n  traverse(Task.of, getLegislators(mdl), mdl.states)\n    .map(map(path(['response', 'legislator'])))\n    .map(flatten)\n    .map(pluck('@attributes'))\n    .map(saveLegislators(mdl))\n\nconst loadMemberProfile = mdl => legislators =>\n  traverse(Task.of, getMembers(mdl), pluck('cid', legislators))\n  .map(map(path(['response', 'member_profile'])))\n  .map(flatten)\n  .map(pluck('@attributes'))\n\nconst loadData = mdl => state => {\n  state.status = 'loading'\n  const onSuccess =members => {\n    mdl.data.legislators.map(leg => {\n      leg.data = head(members.filter(propEq('member_id', leg.cid)))\n    })\n    state.status = 'loaded'\n  }\n  const onError =err => {\n    console.error(err)\n    state.status = 'failed'\n  }\n\n  loadLegislatorsData(mdl).chain(loadMemberProfile(mdl)).fork(onError, onSuccess)\n}\n\n\nconst PlotFinances = () => {\n  return {\n    oncreate:({dom, attrs:{mdl}}) => {\n      let data = {type:'bar',\n                  x:mdl.data.legislators.map(l => l.firstlast),\n                  y:mdl.data.legislators.map(l => l.data.net_high)\n                }\nconsole.log('data', data)\n      return mdl.data.legislators && Plotly.newPlot('chart', [data]);\n    },\n    view:({attrs:{mdl}}) =>\n       m('.', {id:'chart',style:{width: '100vw', height: '600px'}})\n  }\n}\n\nconst Legislators = (mdl) => {\n  const state = {\n    status: 'loading'\n  }\n  return {\n    oninit: () => loadData(mdl)(state),\n    view: () => m('.',\n    state.status == 'loading' && IsLoading,\n    state.status == 'failed' && 'FAILED',\n    state.status == 'loaded' && [\n      m(PlotFinances, {mdl}),\n      m('input[type=\"range\"]', {min: 2008, max:2016, step:1,value:mdl.data.year(), onchange:e => {mdl.data.year(e.target.value);\n      loadData(mdl)(state)\n      } }),\n      m('h1',mdl.data.year())\n    ],\n    )\n  }\n}\n\nexport default Legislators\n","import Legislators from \"./app.js\"\nimport model from \"./model.js\"\n\nconst root = document.body\nlet winW = window.innerWidth\n\nif (module.hot) {\n  module.hot.accept()\n}\n\nif (process.env.NODE_ENV !== \"production\") {\n  console.log(\"Looks like we are in development mode!\")\n} else {\n  if (\"serviceWorker\" in navigator) {\n    window.addEventListener(\"load\", () => {\n      navigator.serviceWorker\n        .register(\"./service-worker.js\")\n        .then((registration) => {\n          console.log(\"⚙️ SW registered: \", registration)\n        })\n        .catch((registrationError) => {\n          console.log(\"🧟 SW registration failed: \", registrationError)\n        })\n    })\n  }\n}\n\n// set display profiles\nconst getProfile = (w) => {\n  if (w < 668) return \"phone\"\n  if (w < 920) return \"tablet\"\n  return \"desktop\"\n}\n\nconst checkWidth = (winW) => {\n  const w = window.innerWidth\n  if (winW !== w) {\n    winW = w\n    var lastProfile = model.settings.profile\n    model.settings.profile = getProfile(w)\n    if (lastProfile != model.settings.profile) m.redraw()\n  }\n  return requestAnimationFrame(checkWidth)\n}\n\nmodel.settings.profile = getProfile(winW)\n\ncheckWidth(winW)\n\nm.mount(root, Legislators(model))\n","document.addEventListener(\"DOMContentLoaded\", () => {\n  require(\"./index.js\")\n})\n","const IsLoading = m(\n  \"svg[xmlns='http://www.w3.org/2000/svg'][xmlns:xlink='http://www.w3.org/1999/xlink'][width='200px'][height='200px'][viewBox='0 0 100 100'][preserveAspectRatio='xMidYMid']\",\n  {\n    style: {\n      margin: \"auto\",\n      background: \"rgb(241, 242, 243)\",\n      display: \"block\",\n      \"shape-rendering\": \"auto\"\n    }\n  },\n  m(\n    \"path[d='M10 50A40 40 0 0 0 90 50A40 42 0 0 1 10 50'][fill='#85a2b6'][stroke='none'][transform='rotate(17.5738 50 51)']\",\n    m(\n      \"animateTransform[attributeName='transform'][type='rotate'][dur='1s'][repeatCount='indefinite'][keyTimes='0;1'][values='0 50 51;360 50 51']\"\n    )\n  )\n)\n\n\nexport default IsLoading\n","const api = '4fbc39be8c00b4af07a6f182c64d5c1a'\nconst baseUrl ='http://www.opensecrets.org/api/?method='\nconst apiKey = `&output=json&apikey=${api}`\nconst legislatorUrl = state => `getLegislators&id=${state}`\nconst memberUrl = cid => year => `memPFDprofile&year=${year}&cid=${cid}`\nimport Task from 'data.task'\nimport m from 'mithril'\n\n\nconst HTTP = url => new Task((rej, res)=> m.request(url).then(res,rej))\n\nexport const legislatorsUrl = state => `${baseUrl}${legislatorUrl(state)}${apiKey}`\nexport const membersUrl = cid =>year=> `${baseUrl}${memberUrl(cid)(year)}${apiKey}`\n\n\nconst states = [ 'AL',\n'MT', 'AK','NE', 'AZ','NV', 'AR','NH', 'CA', 'NJ', 'CO',\n                 'NM', 'CT','NY', 'DE','NC', 'FL','ND', 'GA','OH', 'HI','OK',\n                 'ID','OR', 'IL','PA', 'IN','RI', 'IA','SC', 'KS','SD', 'KY','TN',\n                 'LA','TX', 'ME','UT', 'MD','VT', 'MA','VA', 'MI','WA', 'MN','WV', 'MS','WI',\n                 'MO','WY', ]\n\nconst model = {\n  HTTP,\n  states,\n  data: {legislators:null,details: null, year: Stream(2016) },\n  err: null,\n  state: null,\n  settings: {}\n}\n\nexport default model\n"]}